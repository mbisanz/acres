function LoginCtrl(a,b,c,d){a.credentials={userName:"",password:""},b.login=d.getLogin(),a.submit=function(){d.setUserNameAndPassword(a.credentials.userName,a.credentials.password),b.login=d.getLogin()},a.isLoggedIn=function(){return d.isLoggedIn()},a.logOut=function(){d.logOut(),b.login=d.getLogin(),c.path("/")}}!function(){"use strict";angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(a,b){return{loginConfirmed:function(c,d){var e=d||function(a){return a};a.$broadcast("event:auth-loginConfirmed",c),b.retryAll(e)},loginCancelled:function(c,d){b.rejectAll(d),a.$broadcast("event:auth-loginCancelled",c)}}}]).config(["$httpProvider",function(a){a.interceptors.push(["$rootScope","$q","httpBuffer",function(a,b,c){return{responseError:function(d){if(console.log(d),(401===d.status||403===d.status&&d.config.headers["Acres-Default-Authorization"])&&!d.config.ignoreAuthModule){var e=b.defer();return c.append(d.config,e),a.$broadcast("event:auth-loginRequired",d),e.promise}return b.reject(d)}}}])}]),angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(a){function b(b,d){function e(a){d.resolve(a)}function f(a){d.reject(a)}delete b.headers.Authorization,c=c||a.get("$http"),c(b).then(e,f)}var c,d=[];return{append:function(a,b){d.push({config:a,deferred:b})},rejectAll:function(a){if(a)for(var b=0;b<d.length;++b)d[b].deferred.reject(a);d=[]},retryAll:function(a){for(var c=0;c<d.length;++c)b(a(d[c].config),d[c].deferred);d=[]}}}])}(),angular.module("acres",["ngAnimate","ngResource","ngRoute","ngCookies","http-auth-interceptor"]).constant("version","v0.1.0").config(["$locationProvider","$routeProvider",function(a,b){a.html5Mode(!1),b.when("/",{templateUrl:"views/home.html"}).when("/aircrafts",{templateUrl:"views/aircrafts.html",controller:"AircraftCtrl"}).when("/bookings",{templateUrl:"views/bookings.html",controller:"BookingCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("acres").controller("MainCtrl",["$scope","$location","version","showcaseService","loginService",function(a,b,c,d){a.$path=b.path.bind(b),a.version=c,a.resetShowcase=function(){d.save()}}]),angular.module("acres").controller("AircraftCtrl",["$scope","aircraftService","reservationService",function(a,b,c){a.updateAircraftList=function(){b.query(function(b){a.aircrafts=b,a.reservations=null,a.showReservations=!1},function(){alert("Failed to load aircraft list!")})},a.loadAircraftReservations=function(b){c.query({registration:b.registration},function(b){a.reservations=b,a.showReservations=!0},function(){alert("Failed to load bookings list!")})},a.updateAircraftList()}]),angular.module("acres").controller("BookingCtrl",["$scope","reservationWorkflowService",function(a,b){a.loadReservationList=function(){b.query(function(b){a.reservations=b},function(){alert("Failed to load bookings list!")})},a.cancelReservation=function(c){b.remove({resId:c.id},function(){a.loadReservationList()},function(){alert("Failed to cancel booking!")})},a.updateReservation=function(c){b.update({resId:c.id},function(){a.loadReservationList()},function(){alert("Failed to update booking!")})},a.loadReservationList()}]),angular.module("acres").directive("loginDialog",["$timeout",function(a){return{templateUrl:"views/templates/loginDialog.html",restrict:"E",replace:!0,controller:LoginCtrl,link:function(b,c){var d=!1;c.on("shown.bs.modal",function(){c.find("#userName").focus()}),b.$on("event:auth-loginRequired",function(){d||(d=!0,a(function(){c.modal("show"),d=!1},1e3))}),b.$on("event:auth-loginConfirmed",function(){c.modal("hide"),b.credentials.password=""})}}}]).directive("logoutLink",function(){return{templateUrl:"views/templates/logoutLink.html",restrict:"E",replace:!0,controller:LoginCtrl}});var baseUrl="/acres-rest/rest";angular.module("acres").factory("aircraftService",["$resource",function(a){return a(baseUrl+"/ac/:acId",{acId:"@acId"},{update:{method:"PUT"}})}]).factory("reservationService",["$resource",function(a){return a(baseUrl+"/res/:resId",{resId:"@resId"},{update:{method:"PUT"},query:{method:"GET",url:baseUrl+"/res/search",isArray:!0}})}]).factory("reservationWorkflowService",["$resource",function(a){return a(baseUrl+"/reswf/:resId",{resId:"@resId"},{update:{method:"PUT"}})}]).factory("showcaseService",["$resource",function(a){return a(baseUrl+"/showcase")}]).factory("Base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&console.log("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!=g&&(h+=String.fromCharCode(d)),64!=j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}}).service("loginService",function(a,b,c,d){var e=b.get("basicCredentials");return console.log("Initializing authentication from "+e),e?(a.defaults.headers.common.Authorization="Basic "+e,delete a.defaults.headers.common["Acres-Default-Authorization"]):(a.defaults.headers.common.Authorization="Basic "+d.encode("guest:guest"),a.defaults.headers.common["Acres-Default-Authorization"]="true"),{setUserNameAndPassword:function(e,f){var g=d.encode(e+":"+f);b.put("basicCredentials",g),a.defaults.headers.common.Authorization="Basic "+g,delete a.defaults.headers.common["Acres-Default-Authorization"],c.loginConfirmed()},isLoggedIn:function(){return void 0!==b.get("basicCredentials")},getLogin:function(){if(!this.isLoggedIn())return this.getDefaultLogin();var a=b.get("basicCredentials"),c=d.decode(a),e=c.split(":")[0];return e},getDefaultLogin:function(){return"guest"},logOut:function(){b.remove("basicCredentials"),a.defaults.headers.common.Authorization="Basic "+d.encode("guest:guest"),a.defaults.headers.common["Acres-Default-Authorization"]="true"}}});